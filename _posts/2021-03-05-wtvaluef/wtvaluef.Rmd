---
title: "확률 가중 함수와 가치함수"
description: |
  Behavioral economics:Probability-weighted and value functions
categories:
  - Probability Weighted Function
  - Value function
  - Behavioral economics
  - R
author:
  - name: Jongseon, Han
    url: https://hanjongseon.github.io
    orcid_id: 0000-0002-4148-9290
date: 03-05-2021
output:
  distill::distill_article:
    self_contained: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

- 행동 경제학에는 확률가중함수와 가치함수라는 것이 존재한다.<br/>
자세한 내용들은 서적이나 검색을 통해 알 수 있겠지만, 간단히 설명하면 아래와 같다.

><u>**확률가중함수**</u><br/>확률에 대해 사람들이 가중치를 두어 생각한다는 것을 보여주는 함수<br/>
><u>**가치함수**</u><br/>사람의 손실회피 성향을 보여주는 것으로, 손실에 대해서 더 많은 가치 부여를 보이는 경향을 보임



```{r}
library(dplyr)
#확률 가중 함수
w_p = function(p,r=0.65){
  if(p<0){
    k = p * (-1)
    return((k**r)/((k**r)+(1-k)**r)**(1/r)*(-1) * 2.25)
  }
  if(p>0){
    return((p**r)/((p**r)+(1-p)**r)**(1/r))
  }
  if(p==0){
    return(0)
  }
}

# 가치 함수
value_f = function(x){
    if(x>=0){
        y = x**0.88
    }
    if(x<0){
        y = -2.25*(-x)**0.88
    }
    return(y)
}

#확률리스트 생성
p_list = seq(-1,1,by=0.01)
p_df = data.frame(p_list)
p_df$W_P = unlist(Map(w_p, abs(p_list)))
p_df$VALUE_F = unlist(Map(value_f, p_list))
p_df$FELL_VALUE = p_df$W_P*p_df$VALUE_F
#head(p_df)
p_df_reform = tidyr::gather(p_df, key="TYPE",value='value',-p_list) %>% filter(TYPE!='W_P')

library(ggplot2)
ggplot() + geom_point(data=p_df_reform, aes(x=p_list, y=value, group=TYPE, col=TYPE))+
  geom_point(data=p_df_reform, aes(x=p_list, y=p_list), col='grey')+
  xlab('real prob(%)')+
  ylab('Probability of feeling') + theme_bw()


```
```{r}
library(data.table)
sample_data = fread("/home/hanjongseon/distill/STOCK_000020.txt")
head(sample_data)
sample_data$W_P = unlist(Map(w_p,abs(sample_data$changed)))
sample_data$VALUE_F = unlist(Map(value_f,sample_data$changed))
sample_data$FELL_VALUE = sample_data$W_P*sample_data$VALUE_F
sample_data %>% head()
sample_data2 = sample_data %>% dplyr::select(Close, changed, W_P, VALUE_F, FELL_VALUE)
sample_data2$ABS_DIFF = sample_data2$FELL_VALUE-sample_data2$changed
sample_data2 = sample_data2 %>% tail(200)
p_df_reform = tidyr::gather(sample_data2, key="TYPE",value='value',-changed) %>% filter(TYPE!='W_P')
library(ggplot2)
ggplot() + 
  geom_point(data=sample_data2, aes(x=1:nrow(sample_data2), y=changed), col='grey')+
  geom_point(data=sample_data2, aes(x=1:nrow(sample_data2), y=VALUE_F), col='red')+
  geom_point(data=sample_data2, aes(x=1:nrow(sample_data2), y=FELL_VALUE), col='blue')+
  geom_point(data=sample_data2, aes(x=1:nrow(sample_data2), y=Close/(max(Close))*20, col=ABS_DIFF), alpha=0.5)+
  scale_color_gradient(low="blue", high="red")+
  xlab('real prob(%)')+
  ylab('Probability of feeling') + theme_bw()

ggplot() + 
  geom_smooth(data=sample_data2, aes(x=1:nrow(sample_data2), y=CLOSE1), col='red', span=0.05)+
  geom_smooth(data=sample_data2, aes(x=1:nrow(sample_data2), y=CLOSE2), col='blue', span=0.05)
  scale_color_gradient(low="blue", high="red")+
  xlab('real prob(%)')+
  ylab('Probability of feeling') + theme_bw()
```

<<<<<<< HEAD
sample_data2 = 
  sample_data2 %>% 
  mutate(
    PRICE_1 = Close*(1-changed),
    PRICE_2 = Close*(1-FELL_VALUE)
  )

sample_data2$CLOSE1_SMA = SMA(sample_data2$CLOSE1,5)
sample_data2$CLOSE2_SMA = SMA(sample_data2$CLOSE2,5)

ggplot() + 
  geom_line(data=sample_data2[1:20], aes(x=1:nrow(sample_data2[1:20]), y=CLOSE1_SMA), col='red')+
  geom_line(data=sample_data2[1:20], aes(x=1:nrow(sample_data2[1:20]), y=CLOSE2_SMA), col='blue')
  



ggplot() + 
  geom_smooth(data=sample_data2, aes(x=1:nrow(sample_data2), y=CLOSE1), col='red', span=0.05)+
  geom_smooth(data=sample_data2, aes(x=1:nrow(sample_data2), y=CLOSE2), col='blue', span=0.05)

Distill is a publication format for scientific and technical writing, native to the web.

Learn more about using Distill at <https://rstudio.github.io/distill>.


=======
- 간단한 그래프이다. 실제 확률에 대해서 체감하는 확률이다. 사회현상에 대하여 이것을 알고리즘이나 휴리스틱으로 연구하는 코드를 보고 싶은데 아직은 보지 못했다. 내가 할 수 있다면(이것이 효용이 있다는 것이 증명되면) 한번 나중에 그 내용을 올려보고자 한다.
>>>>>>> 69eec3ac01e912f19d7cd0dd473791df2688b303
